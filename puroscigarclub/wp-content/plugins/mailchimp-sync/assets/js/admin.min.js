!function e(t,n,r){function o(i,l){if(!n[i]){if(!t[i]){var s="function"==typeof require&&require;if(!l&&s)return s(i,!0);if(a)return a(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[i]={exports:{}};t[i][0].call(c.exports,function(e){var n=t[i][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[i].exports}for(var a="function"==typeof require&&require,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(e,t,n){"use strict";function r(e){for(var t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_",n="",r=e;r>0;--r)n+=t[Math.floor(Math.random()*t.length)];return n}function o(){var e=d.value.replace(/\W+/g,"");e!=d.value&&(d.value=e);var t=f.getAttribute("data-url-format");f.value=t.replace("%s",d.value)}function a(){d.value=r(20),o()}var i=window.m=e("mithril"),l=e("./admin/wizard.js"),s=e("./admin/field-mapper.js"),u=window.jQuery,c=document.getElementById("wizard");c&&i.module(c,l),new s(u(".mc4wp-sync-field-map"));var d=document.getElementById("webhook-secret-key-input"),f=document.getElementById("webhook-url-input"),h=document.getElementById("webhook-generate-button");u(d).keyup(o),u(h).click(a)},{"./admin/field-mapper.js":2,"./admin/wizard.js":5,mithril:6}],2:[function(e,t,n){var r=function(e){function t(){var t=e.find(".field-map-row").last(),n=t.clone(),o=n.find(".user-field"),a=n.find(".mailchimp-field");return o.val("").suggest(ajaxurl+"?action=mcs_autocomplete_user_field").attr("name",o.attr("name").replace(/\[(\d+)\]/,function(e,t){return"["+(parseInt(t,10)+1)+"]"})),a.val("").attr("name",a.attr("name").replace(/\[(\d+)\]/,function(e,t){return"["+(parseInt(t,10)+1)+"]"})),n.insertAfter(t),r(),!1}function n(){o(this).parents(".field-map-row").remove(),r()}function r(){var t=e.find(".mailchimp-field");t.each(function(){var e=t.not(this),n=o.map(e,function(e,t){return o(e).val()});o(this).find("option").each(function(){var e=o(this).val(),t=o.inArray(e,n)>-1;o(this).prop("disabled",""===e||t)})})}var o=window.jQuery;e.find(".user-field").suggest(ajaxurl+"?action=mcs_autocomplete_user_field"),e.find(".mailchimp-field").change(r).trigger("change"),e.find(".add-row").click(t),e.on("click",".remove-row",n)};t.exports=r},{}],3:[function(e,t,n){var r=function(){var e=this;this.items=m.prop([]),this.addLine=function(t){var n={time:new Date,text:t};e.items().push(n),m.redraw()},this.addTextToLastLine=function(t){var n=e.items().pop();n.text+=" "+t,e.items().push(n),m.redraw()},this.scrollToBottom=function(e,t,n){e.scrollTop=e.scrollHeight},this.render=function(){return m("div.log",{config:e.scrollToBottom},[e.items().map(function(e){var t=("0"+e.time.getHours()).slice(-2)+":"+("0"+e.time.getMinutes()).slice(-2)+":"+("0"+e.time.getSeconds()).slice(-2);return m("div",[m("span.time",t),m.trust(e.text)])})])}};t.exports=r},{}],4:[function(e,t,n){var r=function(e){this.id=m.prop(e.ID),this.username=m.prop(e.user_login),this.email=m.prop(e.user_email)};t.exports=r},{}],5:[function(e,t,n){var r=e("./log.js"),o=e("./user.js"),a=function(){function e(){f=document.getElementById("settings-form"),f.addEventListener("change",function(){b(!0),m.redraw()})}function t(){var e=confirm("Are you sure you want to start synchronising all of your users? This can take a while if you have many users, please don't close your browser window.");e&&n()}function n(){h=!0,p=!0,l().then(s).then(u)}function a(){p=!0,u(),m.redraw()}function i(){p=!1,m.redraw()}function l(){var e=m.deferred(),t={action:"mcs_wizard",mcs_action:"get_user_count"};return m.request({method:"GET",url:ajaxurl,data:t}).then(function(t){x.addLine("Found "+t+" users."),v=t,e.resolve()}),e.promise}function s(){var e=m.deferred();return m.request({method:"GET",url:ajaxurl,data:{action:"mcs_wizard",mcs_action:"get_users",offset:y,limit:100},type:o}).then(function(t){x.addLine("Fetched "+t.length+" users."),E(t),e.resolve(),m.redraw()},function(e){x.addLine("Error fetching users. Error: "+e)}),e.promise}function u(){if(p&&!g){if(0===E().length)return void(v>y&&s().then(u));var e=E().shift();x.addLine("Updating <strong> #"+e.id()+" "+e.username()+" &lt;"+e.email()+"&gt;</strong>");var t={action:"mcs_wizard",mcs_action:"subscribe_users",user_id:e.id()};m.request({method:"GET",data:t,url:ajaxurl}).then(function(e){y++,e.success&&x.addLine("Success!"),e.error&&x.addLine("Error: "+e.error),c(),u()},function(e){x.addLine("Error: "+e)})}}function c(){var e=Math.round(y/v*100);w(e),e>=100&&(g=!0,x.addLine("Done!"))}function d(){return h?[g?"":m("p",[m("input",{type:"button","class":"button",value:p?"Pause":"Resume",onclick:p?i:a})]),m("div.progress-bar",[m("div.value",{style:"width: "+w()+"%"}),m("div.text",{},100==w()?"Done!":"Working: "+w()+"%")]),x.render()]:m("p",[m("input",{type:"button","class":"button",value:"Synchronise All",onclick:t,disabled:b()}),b()?m("span.help"," â€” Please save your changes first."):""])}var f,h=!1,p=!1,g=!1,v=0,y=0,w=m.prop(0),x=new r,E=m.prop([]),b=m.prop(!1);return{controller:e,view:d}}();t.exports=a},{"./log.js":3,"./user.js":4}],6:[function(e,t,n){var r=function o(e,t){function n(e){A=e.document,S=e.location,L=e.cancelAnimationFrame||e.clearTimeout,_=e.requestAnimationFrame||e.setTimeout}function r(){var e,t=[].slice.call(arguments),n=!(null==t[1]||B.call(t[1])!==M||"tag"in t[1]||"view"in t[1]||"subtree"in t[1]),r=n?t[1]:{},o="class"in r?"class":"className",a={tag:"div",attrs:{}},i=[];if(B.call(t[0])!=D)throw new Error("selector in m(selector, attrs, children) should be a string");for(;e=q.exec(t[0]);)if(""===e[1]&&e[2])a.tag=e[2];else if("#"===e[1])a.attrs.id=e[2];else if("."===e[1])i.push(e[2]);else if("["===e[3][0]){var l=U.exec(e[3]);a.attrs[l[1]]=l[3]||(l[2]?"":!0)}var s=n?t.slice(2):t.slice(1);1===s.length&&B.call(s[0])===R?a.children=s[0]:a.children=s;for(var u in r)r.hasOwnProperty(u)&&(u===o&&null!=r[u]&&""!==r[u]?(i.push(r[u]),a.attrs[u]=""):a.attrs[u]=r[u]);return i.length>0&&(a.attrs[o]=i.join(" ")),a}function a(e,n,o,u,d,f,h,m,p,g,v){try{(null==d||null==d.toString())&&(d="")}catch(y){d=""}if("retain"===d.subtree)return f;var w=B.call(f),x=B.call(d);if(null==f||w!==x){if(null!=f)if(o&&o.nodes){var E=m-u,b=E+(x===R?d:f.nodes).length;s(o.nodes.slice(E,b),o.slice(E,b))}else f.nodes&&s(f.nodes,f);f=new d.constructor,f.tag&&(f={}),f.nodes=[]}if(x===R){for(var k=0,C=d.length;C>k;k++)B.call(d[k])===R&&(d=d.concat.apply([],d),k--,C=d.length);for(var j=[],N=f.length===d.length,T=0,O=1,S=2,_=3,L={},q=!1,k=0;k<f.length;k++)f[k]&&f[k].attrs&&null!=f[k].attrs.key&&(q=!0,L[f[k].attrs.key]={action:O,index:k});for(var U=0,k=0,C=d.length;C>k;k++)if(d[k]&&d[k].attrs&&null!=d[k].attrs.key){for(var H=0,C=d.length;C>H;H++)d[H]&&d[H].attrs&&null==d[H].attrs.key&&(d[H].attrs.key="__mithril__"+U++);break}if(q){var G=!1;if(d.length!=f.length)G=!0;else for(var F,J,k=0;F=f[k],J=d[k];k++)if(F.attrs&&J.attrs&&F.attrs.key!=J.attrs.key){G=!0;break}if(G){for(var k=0,C=d.length;C>k;k++)if(d[k]&&d[k].attrs&&null!=d[k].attrs.key){var K=d[k].attrs.key;L[K]?L[K]={action:_,index:k,from:L[K].index,element:f.nodes[L[K].index]||A.createElement("div")}:L[K]={action:S,index:k}}var P=[];for(var Q in L)P.push(L[Q]);var V=P.sort(i),W=new Array(f.length);W.nodes=f.nodes.slice();for(var Y,k=0;Y=V[k];k++){if(Y.action===O&&(s(f[Y.index].nodes,f[Y.index]),W.splice(Y.index,1)),Y.action===S){var X=A.createElement("div");X.key=d[Y.index].attrs.key,e.insertBefore(X,e.childNodes[Y.index]||null),W.splice(Y.index,0,{attrs:{key:d[Y.index].attrs.key},nodes:[X]}),W.nodes[Y.index]=X}Y.action===_&&(e.childNodes[Y.index]!==Y.element&&null!==Y.element&&e.insertBefore(Y.element,e.childNodes[Y.index]||null),W[Y.index]=f[Y.from],W.nodes[Y.index]=Y.element)}f=W}}for(var k=0,Z=0,C=d.length;C>k;k++){var te=a(e,n,f,m,d[k],f[Z],h,m+T||T,p,g,v);te!==t&&(te.nodes.intact||(N=!1),T+=te.$trusted?(te.match(/<[^\/]|\>\s*[^<]/g)||[0]).length:B.call(te)===R?te.length:1,f[Z++]=te)}if(!N){for(var k=0,C=d.length;C>k;k++)null!=f[k]&&j.push.apply(j,f[k].nodes);for(var ne,k=0;ne=f.nodes[k];k++)null!=ne.parentNode&&j.indexOf(ne)<0&&s([ne],[f[k]]);d.length<f.length&&(f.length=d.length),f.nodes=j}}else if(null!=d&&x===M){for(var oe=[],ae=[];d.view;){var ie=d.view.$original||d.view,le="diff"==r.redraw.strategy()&&f.views?f.views.indexOf(ie):-1,se=le>-1?f.controllers[le]:new(d.controller||$),K=d&&d.attrs&&d.attrs.key;if(d=0==re||f&&f.controllers&&f.controllers.indexOf(se)>-1?d.view(se):{tag:"placeholder"},"retain"===d.subtree)return f;K&&(d.attrs||(d.attrs={}),d.attrs.key=K),se.onunload&&ee.push({controller:se,handler:se.onunload}),oe.push(ie),ae.push(se)}if(!d.tag&&ae.length)throw new Error("Component template must return a virtual element, not an array, string, etc.");d.attrs||(d.attrs={}),f.attrs||(f.attrs={});var ue=Object.keys(d.attrs),ce=ue.length>("key"in d.attrs?1:0);if((d.tag!=f.tag||ue.sort().join()!=Object.keys(f.attrs).sort().join()||d.attrs.id!=f.attrs.id||d.attrs.key!=f.attrs.key||"all"==r.redraw.strategy()&&(!f.configContext||f.configContext.retain!==!0)||"diff"==r.redraw.strategy()&&f.configContext&&f.configContext.retain===!1)&&(f.nodes.length&&s(f.nodes),f.configContext&&typeof f.configContext.onunload===I&&f.configContext.onunload(),f.controllers))for(var se,k=0;se=f.controllers[k];k++)typeof se.onunload===I&&se.onunload({preventDefault:$});if(B.call(d.tag)!=D)return;var ne,de=0===f.nodes.length;if(d.attrs.xmlns?g=d.attrs.xmlns:"svg"===d.tag?g="http://www.w3.org/2000/svg":"math"===d.tag&&(g="http://www.w3.org/1998/Math/MathML"),de){if(ne=d.attrs.is?g===t?A.createElement(d.tag,d.attrs.is):A.createElementNS(g,d.tag,d.attrs.is):g===t?A.createElement(d.tag):A.createElementNS(g,d.tag),f={tag:d.tag,attrs:ce?l(ne,d.tag,d.attrs,{},g):d.attrs,children:null!=d.children&&d.children.length>0?a(ne,d.tag,t,t,d.children,f.children,!0,0,d.attrs.contenteditable?ne:p,g,v):d.children,nodes:[ne]},ae.length){f.views=oe,f.controllers=ae;for(var se,k=0;se=ae[k];k++)if(se.onunload&&se.onunload.$old&&(se.onunload=se.onunload.$old),re&&se.onunload){var fe=se.onunload;se.onunload=$,se.onunload.$old=fe}}f.children&&!f.children.nodes&&(f.children.nodes=[]),"select"===d.tag&&"value"in d.attrs&&l(ne,d.tag,{value:d.attrs.value},{},g),e.insertBefore(ne,e.childNodes[m]||null)}else ne=f.nodes[0],ce&&l(ne,d.tag,d.attrs,f.attrs,g),f.children=a(ne,d.tag,t,t,d.children,f.children,!1,0,d.attrs.contenteditable?ne:p,g,v),f.nodes.intact=!0,ae.length&&(f.views=oe,f.controllers=ae),h===!0&&null!=ne&&e.insertBefore(ne,e.childNodes[m]||null);if(typeof d.attrs.config===I){var he=f.configContext=f.configContext||{},me=function(e,t){return function(){return e.attrs.config.apply(e,t)}};v.push(me(d,[ne,!de,he,f]))}}else if(typeof d!=I){var j;0===f.nodes.length?(d.$trusted?j=c(e,m,d):(j=[A.createTextNode(d)],e.nodeName.match(z)||e.insertBefore(j[0],e.childNodes[m]||null)),f="string number boolean".indexOf(typeof d)>-1?new d.constructor(d):d,f.nodes=j):f.valueOf()!==d.valueOf()||h===!0?(j=f.nodes,p&&p===A.activeElement||(d.$trusted?(s(j,f),j=c(e,m,d)):"textarea"===n?e.value=d:p?p.innerHTML=d:((1===j[0].nodeType||j.length>1)&&(s(f.nodes,f),j=[A.createTextNode(d)]),e.insertBefore(j[0],e.childNodes[m]||null),j[0].nodeValue=d)),f=new d.constructor(d),f.nodes=j):f.nodes.intact=!0}return f}function i(e,t){return e.action-t.action||e.index-t.index}function l(e,t,n,r,o){for(var a in n){var i=n[a],l=r[a];if(a in r&&l===i)"value"===a&&"input"===t&&e.value!=i&&(e.value=i);else{r[a]=i;try{if("config"===a||"key"==a)continue;if(typeof i===I&&0===a.indexOf("on"))e[a]=d(i,e);else if("style"===a&&null!=i&&B.call(i)===M){for(var s in i)(null==l||l[s]!==i[s])&&(e.style[s]=i[s]);for(var s in l)s in i||(e.style[s]="")}else null!=o?"href"===a?e.setAttributeNS("http://www.w3.org/1999/xlink","href",i):"className"===a?e.setAttribute("class",i):e.setAttribute(a,i):a in e&&"list"!==a&&"style"!==a&&"form"!==a&&"type"!==a&&"width"!==a&&"height"!==a?("input"!==t||e[a]!==i)&&(e[a]=i):e.setAttribute(a,i)}catch(u){if(u.message.indexOf("Invalid argument")<0)throw u}}}return r}function s(e,t){for(var n=e.length-1;n>-1;n--)if(e[n]&&e[n].parentNode){try{e[n].parentNode.removeChild(e[n])}catch(r){}t=[].concat(t),t[n]&&u(t[n])}0!=e.length&&(e.length=0)}function u(e){if(e.configContext&&typeof e.configContext.onunload===I&&(e.configContext.onunload(),e.configContext.onunload=null),e.controllers)for(var t,n=0;t=e.controllers[n];n++)typeof t.onunload===I&&t.onunload({preventDefault:$});if(e.children)if(B.call(e.children)===R)for(var r,n=0;r=e.children[n];n++)u(r);else e.children.tag&&u(e.children)}function c(e,t,n){var r=e.childNodes[t];if(r){var o=1!=r.nodeType,a=A.createElement("span");o?(e.insertBefore(a,r||null),a.insertAdjacentHTML("beforebegin",n),e.removeChild(a)):r.insertAdjacentHTML("beforebegin",n)}else e.insertAdjacentHTML("beforeend",n);for(var i=[];e.childNodes[t]!==r;)i.push(e.childNodes[t]),t++;return i}function d(e,t){return function(n){n=n||event,r.redraw.strategy("diff"),r.startComputation();try{return e.call(t,n)}finally{oe()}}}function f(e){var t=F.indexOf(e);return 0>t?F.push(e)-1:t}function h(e){var t=function(){return arguments.length&&(e=arguments[0]),e};return t.toJSON=function(){return e},t}function m(e,t){var n=function(){return(e.controller||$).apply(this,t)||this},r=function(n){return arguments.length>1&&(t=t.concat([].slice.call(arguments,1))),e.view.apply(e,t?[n].concat(t):[n])};r.$original=e.view;var o={controller:n,view:r};return t[0]&&null!=t[0].key&&(o.attrs={key:t[0].key}),o}function p(){X&&(X(),X=null);for(var e,t=0;e=P[t];t++)if(V[t]){var n=Q[t].controller&&Q[t].controller.$$args?[V[t]].concat(Q[t].controller.$$args):[V[t]];r.render(e,Q[t].view?Q[t].view(V[t],n):"")}Z&&(Z(),Z=null),W=null,Y=new Date,r.redraw.strategy("diff")}function g(e){return e.slice(le[r.route.mode].length)}function v(e,t,n){ae={};var o=n.indexOf("?");-1!==o&&(ae=E(n.substr(o+1,n.length)),n=n.substr(0,o));var a=Object.keys(t),i=a.indexOf(n);if(-1!==i)return r.mount(e,t[a[i]]),!0;for(var l in t){if(l===n)return r.mount(e,t[l]),!0;var s=new RegExp("^"+l.replace(/:[^\/]+?\.{3}/g,"(.*?)").replace(/:[^\/]+/g,"([^\\/]+)")+"/?$");if(s.test(n))return n.replace(s,function(){for(var n=l.match(/:[^\/]+/g)||[],o=[].slice.call(arguments,1,-2),a=0,i=n.length;i>a;a++)ae[n[a].replace(/:|\./g,"")]=decodeURIComponent(o[a]);r.mount(e,t[l])}),!0}}function y(e){if(e=e||event,!e.ctrlKey&&!e.metaKey&&2!==e.which){e.preventDefault?e.preventDefault():e.returnValue=!1;for(var t=e.currentTarget||e.srcElement,n="pathname"===r.route.mode&&t.search?E(t.search.slice(1)):{};t&&"A"!=t.nodeName.toUpperCase();)t=t.parentNode;r.route(t[r.route.mode].slice(le[r.route.mode].length),n)}}function w(){"hash"!=r.route.mode&&S.hash?S.hash=S.hash:e.scrollTo(0,0)}function x(e,n){var r={},o=[];for(var a in e){var i=n?n+"["+a+"]":a,l=e[a],s=B.call(l),u=null===l?encodeURIComponent(i):s===M?x(l,i):s===R?l.reduce(function(e,t){return r[i]||(r[i]={}),r[i][t]?e:(r[i][t]=!0,e.concat(encodeURIComponent(i)+"="+encodeURIComponent(t)))},[]).join("&"):encodeURIComponent(i)+"="+encodeURIComponent(l);l!==t&&o.push(u)}return o.join("&")}function E(e){"?"===e.charAt(0)&&(e=e.substring(1));for(var t=e.split("&"),n={},r=0,o=t.length;o>r;r++){var a=t[r].split("="),i=decodeURIComponent(a[0]),l=2==a.length?decodeURIComponent(a[1]):null;null!=n[i]?(B.call(n[i])!==R&&(n[i]=[n[i]]),n[i].push(l)):n[i]=l}return n}function b(e){var n=f(e);s(e.childNodes,J[n]),J[n]=t}function k(e,t){var n=r.prop(t);return e.then(n),n.then=function(n,r){return k(e.then(n,r),t)},n}function C(e,t){function n(e){d=e||u,h.map(function(e){d===s&&e.resolve(f)||e.reject(f)})}function o(e,t,n,o){if((null!=f&&B.call(f)===M||typeof f===I)&&typeof e===I)try{var a=0;e.call(f,function(e){a++||(f=e,t())},function(e){a++||(f=e,n())})}catch(i){r.deferred.onerror(i),f=i,n()}else o()}function a(){var u;try{u=f&&f.then}catch(h){return r.deferred.onerror(h),f=h,d=l,a()}o(u,function(){d=i,a()},function(){d=l,a()},function(){try{d===i&&typeof e===I?f=e(f):d===l&&"function"==typeof t&&(f=t(f),d=i)}catch(a){return r.deferred.onerror(a),f=a,n()}f===c?(f=TypeError(),n()):o(u,function(){n(s)},n,function(){n(d===i&&s)})})}var i=1,l=2,s=3,u=4,c=this,d=0,f=0,h=[];c.promise={},c.resolve=function(e){return d||(f=e,d=i,a()),this},c.reject=function(e){return d||(f=e,d=l,a()),this},c.promise.then=function(e,t){var n=new C(e,t);return d===s?n.resolve(f):d===u?n.reject(f):h.push(n),n.promise}}function j(e){return e}function N(n){if(!n.dataType||"jsonp"!==n.dataType.toLowerCase()){var r=new e.XMLHttpRequest;if(r.open(n.method,n.url,!0,n.user,n.password),r.onreadystatechange=function(){4===r.readyState&&(r.status>=200&&r.status<300?n.onload({type:"load",target:r}):n.onerror({type:"error",target:r}))},n.serialize===JSON.stringify&&n.data&&"GET"!==n.method&&r.setRequestHeader("Content-Type","application/json; charset=utf-8"),n.deserialize===JSON.parse&&r.setRequestHeader("Accept","application/json, text/*"),typeof n.config===I){var o=n.config(r,n);null!=o&&(r=o)}var a="GET"!==n.method&&n.data?n.data:"";if(a&&B.call(a)!=D&&a.constructor!=e.FormData)throw"Request data should be either be a string or FormData. Check the `serialize` option in `m.request`";return r.send(a),r}var i="mithril_callback_"+(new Date).getTime()+"_"+Math.round(1e16*Math.random()).toString(36),l=A.createElement("script");e[i]=function(r){l.parentNode.removeChild(l),n.onload({type:"load",target:{responseText:r}}),e[i]=t},l.onerror=function(r){return l.parentNode.removeChild(l),n.onerror({type:"error",target:{status:500,responseText:JSON.stringify({error:"Error making jsonp request"})}}),e[i]=t,!1},l.onload=function(e){return!1},l.src=n.url+(n.url.indexOf("?")>0?"&":"?")+(n.callbackKey?n.callbackKey:"callback")+"="+i+"&"+x(n.data||{}),A.body.appendChild(l)}function T(e,t,n){if("GET"===e.method&&"jsonp"!=e.dataType){var r=e.url.indexOf("?")<0?"?":"&",o=x(t);e.url=e.url+(o?r+o:"")}else e.data=n(t);return e}function O(e,t){var n=e.match(/:[a-z]\w+/gi);if(n&&t)for(var r=0;r<n.length;r++){var o=n[r].slice(1);e=e.replace(n[r],t[o]),delete t[o]}return e}var A,S,_,L,M="[object Object]",R="[object Array]",D="[object String]",I="function",B={}.toString,q=/(?:(^|#|\.)([^#\.\[\]]+))|(\[.+?\])/g,U=/\[(.+?)(?:=("|'|)(.*?)\2)?\]/,z=/^(AREA|BASE|BR|COL|COMMAND|EMBED|HR|IMG|INPUT|KEYGEN|LINK|META|PARAM|SOURCE|TRACK|WBR)$/,$=function(){};n(e);var H,G={appendChild:function(e){H===t&&(H=A.createElement("html")),A.documentElement&&A.documentElement!==e?A.replaceChild(e,A.documentElement):A.appendChild(e),this.childNodes=A.childNodes},insertBefore:function(e){this.appendChild(e)},childNodes:[]},F=[],J={};r.render=function(e,n,r){var o=[];if(!e)throw new Error("Ensure the DOM element being passed to m.route/m.mount/m.render is not undefined.");var i=f(e),l=e===A,u=l||e===A.documentElement?G:e;l&&"html"!=n.tag&&(n={tag:"html",attrs:{},children:n}),J[i]===t&&s(u.childNodes),r===!0&&b(e),J[i]=a(u,null,t,t,n,J[i],!1,0,null,t,o);for(var c=0,d=o.length;d>c;c++)o[c]()},r.trust=function(e){return e=new String(e),e.$trusted=!0,e},r.prop=function(e){return(null!=e&&B.call(e)===M||typeof e===I)&&typeof e.then===I?k(e):h(e)};var K,P=[],Q=[],V=[],W=null,Y=0,X=null,Z=null,ee=[],te=16;r.component=function(e){return m(e,[].slice.call(arguments,1))},r.mount=r.module=function(e,t){if(!e)throw new Error("Please ensure the DOM element exists before rendering a template into it.");var n=P.indexOf(e);0>n&&(n=P.length);for(var o,a=!1,i={preventDefault:function(){a=!0,X=Z=null}},l=0;o=ee[l];l++)o.handler.call(o.controller,i),o.controller.onunload=null;if(a)for(var o,l=0;o=ee[l];l++)o.controller.onunload=o.handler;else ee=[];if(V[n]&&typeof V[n].onunload===I&&V[n].onunload(i),!a){r.redraw.strategy("all"),r.startComputation(),P[n]=e,arguments.length>2&&(t=subcomponent(t,[].slice.call(arguments,2)));var s=K=t=t||{controller:function(){}},u=t.controller||$,c=new u;return s===K&&(V[n]=c,Q[n]=t),oe(),V[n]}};var ne=!1;r.redraw=function(t){ne||(ne=!0,W&&t!==!0?(_===e.requestAnimationFrame||new Date-Y>te)&&(W>0&&L(W),W=_(p,te)):(p(),W=_(function(){W=null},te)),ne=!1)},r.redraw.strategy=r.prop();var re=0;r.startComputation=function(){re++},r.endComputation=function(){re=Math.max(re-1,0),0===re&&r.redraw()};var oe=function(){"none"==r.redraw.strategy()?(re--,r.redraw.strategy("diff")):r.endComputation()};r.withAttr=function(e,t){return function(n){n=n||event;var r=n.currentTarget||this;t(e in r?r[e]:r.getAttribute(e))}};var ae,ie,le={pathname:"",hash:"#",search:"?"},se=$,ue=!1;return r.route=function(){if(0===arguments.length)return ie;if(3===arguments.length&&B.call(arguments[1])===D){var t=arguments[0],n=arguments[1],o=arguments[2];se=function(e){var a=ie=g(e);if(!v(t,o,a)){if(ue)throw new Error("Ensure the default route matches one of the routes defined in m.route");ue=!0,r.route(n,!0),ue=!1}};var a="hash"===r.route.mode?"onhashchange":"onpopstate";e[a]=function(){var e=S[r.route.mode];"pathname"===r.route.mode&&(e+=S.search),ie!=g(e)&&se(e)},X=w,e[a]()}else if(arguments[0].addEventListener||arguments[0].attachEvent){var i=arguments[0],l=(arguments[1],arguments[2],arguments[3]);i.href=("pathname"!==r.route.mode?S.pathname:"")+le[r.route.mode]+l.attrs.href,i.addEventListener?(i.removeEventListener("click",y),i.addEventListener("click",y)):(i.detachEvent("onclick",y),i.attachEvent("onclick",y))}else if(B.call(arguments[0])===D){var s=ie;ie=arguments[0];var u=arguments[1]||{},c=ie.indexOf("?"),d=c>-1?E(ie.slice(c+1)):{};for(var f in u)d[f]=u[f];var h=x(d),m=c>-1?ie.slice(0,c):ie;h&&(ie=m+(-1===m.indexOf("?")?"?":"&")+h);var p=(3===arguments.length?arguments[2]:arguments[1])===!0||s===arguments[0];e.history.pushState?(X=w,Z=function(){e.history[p?"replaceState":"pushState"](null,A.title,le[r.route.mode]+ie)},se(le[r.route.mode]+ie)):(S[r.route.mode]=ie,se(le[r.route.mode]+ie))}},r.route.param=function(e){if(!ae)throw new Error("You must call m.route(element, defaultRoute, routes) before calling m.route.param()");return ae[e]},r.route.mode="search",r.route.buildQueryString=x,r.route.parseQueryString=E,r.deferred=function(){var e=new C;return e.promise=k(e.promise),e},r.deferred.onerror=function(e){if("[object Error]"===B.call(e)&&!e.constructor.toString().match(/ Error/))throw e},r.sync=function(e){function t(e,t){return function(r){return i[e]=r,t||(n="reject"),0===--a&&(o.promise(i),o[n](i)),r}}var n="resolve",o=r.deferred(),a=e.length,i=new Array(a);if(e.length>0)for(var l=0;l<e.length;l++)e[l].then(t(l,!0),t(l,!1));else o.resolve([]);return o.promise},r.request=function(e){e.background!==!0&&r.startComputation();var t=new C,n=e.dataType&&"jsonp"===e.dataType.toLowerCase(),o=e.serialize=n?j:e.serialize||JSON.stringify,a=e.deserialize=n?j:e.deserialize||JSON.parse,i=n?function(e){return e.responseText}:e.extract||function(e){return 0===e.responseText.length&&a===JSON.parse?null:e.responseText};return e.method=(e.method||"GET").toUpperCase(),e.url=O(e.url,e.data),e=T(e,e.data,o),e.onload=e.onerror=function(n){try{n=n||event;var o=("load"===n.type?e.unwrapSuccess:e.unwrapError)||j,l=o(a(i(n.target,e)),n.target);if("load"===n.type)if(B.call(l)===R&&e.type)for(var s=0;s<l.length;s++)l[s]=new e.type(l[s]);else e.type&&(l=new e.type(l));t["load"===n.type?"resolve":"reject"](l)}catch(n){r.deferred.onerror(n),t.reject(n)}e.background!==!0&&r.endComputation()},N(e),t.promise=k(t.promise,e.initialValue),t.promise},r.deps=function(t){return n(e=t||e),e},r.deps.factory=o,r}("undefined"!=typeof window?window:{});"undefined"!=typeof t&&null!==t&&t.exports?t.exports=r:"function"==typeof define&&define.amd&&define(function(){return r})},{}]},{},[1]);